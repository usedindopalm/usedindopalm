const translations = {
    en: {
        nav_about: "About Us",
        nav_process: "Our Process",
        nav_impact: "Sustainability",
        nav_contact: "Contact",
        hero_title: "Powering the Future with <span class='text-gradient'>Sustainable Energy</span>",
        hero_subtitle: "Global leader in premium Used Cooking Oil (UCO) collection and export for renewable biodiesel production.",
        btn_partner: "Partner With Us",
        btn_learn_more: "Learn More",
        cert_iscc: "ISCC Certified",
        cert_traceable: "100% Traceable",
        cert_global: "Global Export Chain",
        news_title: "Zona EBT News",
        news_1: "Indonesia's Electricity Sales: Households Remain Dominant in 2026.",
        news_2: "Toyota Motor Manufacturing Indonesia Holds PLTS Maintenance Training 2026.",
        news_3: "Indonesia's Energy Mix: Fossil Fuels Still Lead as Renewables Start to Grow.",
        news_4: "ISCC Certification: The Key to Global Sustainable Biofuel Feedstock.",
        news_url_1: "https://zonaebt.com/",
        news_url_2: "https://zonaebt.com/",
        news_url_3: "https://zonaebt.com/",
        news_body_1: "Electricity sales in Indonesia continue to be dominated by the household sector, accounting for over 45% of total consumption.",
        news_body_2: "Toyota Motor Manufacturing Indonesia (TMMIN) has launched a comprehensive training program for PLTS (Solar Power) maintenance.",
        news_body_3: "Indonesia's current energy production still relies heavily on fossil fuels, but the renewable energy (EBT) sector is showing growth.",
        about_title: "Redefining Waste as Value",
        about_desc1: "We are a premier aggregator and exporter of Used Cooking Oil (UCO), bridging the gap between local feedstock and global renewable energy markets.",
        about_desc2: "With strict adherence to ISCC standards, we ensure every drop of oil we collect contributes to a greener planet, reducing carbon footprints worldwide.",
        quality_guaranteed: "Premium Quality <br> Guaranteed",
        process_title: "Our Supply Chain",
        process_subtitle: "Seamless integration from collection to final export.",
        step1_title: "Collection",
        step1_desc: "Sourcing verified UCO from restaurants and industrial partners.",
        step2_title: "Purification",
        step2_desc: "Filtering impurities to meet strict renewable fuel standards.",
        step3_title: "Testing",
        step3_desc: "Rigorous lab testing for free fatty acids (FFA) and moisture content.",
        step4_title: "Global Export",
        step4_desc: "Shipping via Flexibags to biodiesel refineries in Europe & Asia.",
        praising_uco: "Fueling the Circular Economy",
        vision_text: "Our operations directly support the reduction of greenhouse gas emissions by transforming waste into high-demand biodiesel feedstock.",
        contact_title: "Get in Touch",
        contact_desc: "Interested in purchasing or partnering? Contact our global trade team.",
        contact_hq: "Headquarters",
        contact_email: "Email Us",
        contact_whatsapp: "WhatsApp (24/7)",
        contact_wechat: "WeChat",
        btn_show_qr: "Show QR Code",
        btn_hide_qr: "Hide QR Code",
        form_name: "Full Name",
        form_company: "Company",
        form_message: "Message",
        form_email: "Email Address",
        form_submit: "Send Inquiry",
        footer_tagline: "Leading the way in renewable feedstocks.",
        nav_privacy: "Privacy Policy",
        nav_terms: "Terms of Service",
        scan_qr: "Scan QR Code",
        form_success: "Thank you! Your inquiry has been sent. An automated confirmation has been sent to your email.",
        form_error: "Oops! There was a problem submitting your form. Please try again.",
        gallery_title: "Operational Gallery",
        gallery_subtitle: "A glimpse into our daily collection and processing operations.",
        upload_title: "Upload Gallery Photos",
        upload_label: "Click to add photos (Stored permanently in your browser)",
        btn_upload: "Upload",
        specs_title: "Technical Specifications",
        specs_subtitle: "Quality standards (Varies according to end-buyer requirements).",
        spec_param: "Parameter",
        spec_value: "Typical Value (Example)",
        spec_viscosity: "Viscosity @ 40°C",
        spec_buyer_req: "Per Buyer Request",
        certs_title: "Certifications & Documentation",
        cert_safety_title: "Quality & Safety",
        cert_safety_desc: "ISO 22000 / HACCP (Food Safety Handling) compliance ensures complete traceability.",
        cert_sus_title: "Sustainability",
        cert_sus_desc: "ISCC, RSB, and RED II compliant to ensure fuel origin is legal and traceable.",
        cert_docs_title: "Export Documentation",
        nav_specs: "Specifications",
        reg_title: "Export & Regulatory",
        reg_desc: "We strictly adhere to Indonesian trade regulations, ensuring valid permits for uninterrupted global distribution."
    },
    zh: {
        nav_about: "关于我们",
        nav_process: "流程",
        nav_impact: "可持续性",
        nav_contact: "联系我们",
        hero_title: "以<span class='text-gradient'>可持续能源</span>为未来提供动力",
        hero_subtitle: "全球领先的废弃食用油 (UCO) 收集和出口商，致力于可再生生物柴油生产。",
        btn_partner: "成为合作伙伴",
        btn_learn_more: "了解更多",
        cert_iscc: "ISCC 认证",
        cert_traceable: "100% 可追溯",
        cert_global: "全球出口链",
        news_title: "Zona EBT 新闻",
        news_1: "印度尼西亚电力销售：2026年家庭用电仍占据主导地位。",
        news_2: "丰田汽车印尼制造公司举办 2026 年 PLTS 维护培训。",
        news_3: "印尼能源结构：化石燃料仍领先，可再生能源开始增长。",
        news_4: "ISCC 认证：全球可持续生物燃料原料的关键。",
        news_body_1: "印度尼西亚的电力销售继续由家庭部门主导，占总消耗量的 45% 以上。政府的目标是建立一个更高效的分配系统，以支持工业增长，同时向更清洁的能源转型。",
        news_body_2: "印尼丰田汽车制造公司 (TMMIN) 启动了一项关于 PLTS（太阳能）维护的综合培训计划。该倡议旨在为技术人员配备可再生能源技术的最新技能，以支持碳中和目标。",
        news_body_3: "印度尼西亚目前的能源生产仍然严重依赖化石燃料，但可再生能源 (EBT) 部门显示出显著增长。新的太阳能和风能项目正在加速进行，以实现 2025 年能源结构目标。",
        about_title: "变废为宝",
        about_desc1: "我们是一流的废弃食用油 (UCO) 聚合商和出口商，连接本地原料与全球可再生能源市场。",
        about_desc2: "我们严格遵守 ISCC 标准，确保我们收集的每一滴油都为更环保的地球做出贡献，减少全球碳足迹。",
        quality_guaranteed: "优质品质 <br> 保证",
        process_title: "供应链",
        process_subtitle: "从收集到最终出口的无缝整合。",
        step1_title: "收集",
        step1_desc: "从餐厅和工业合作伙伴处采购经过验证的 UCO。",
        step2_title: "净化",
        step2_desc: "过滤杂质以符合严格的可再生燃料标准。",
        step3_title: "检测",
        step3_desc: "对游离脂肪酸 (FFA) 和水分含量进行严格的实验室检测。",
        step4_title: "全球出口",
        step4_desc: "通过液袋运输至欧洲和亚洲的生物柴油精炼厂。",
        vision_title: "推动循环经济",
        vision_text: "我们的运营通过将废物转化为高需求的生物柴油原料，直接支持减少温室气体排放。",
        contact_title: "联系我们",
        contact_desc: "有兴趣购买或合作？请联系我们的全球贸易团队。",
        contact_hq: "总部",
        contact_email: "发送邮件",
        contact_whatsapp: "WhatsApp (24/7)",
        contact_wechat: "微信",
        btn_show_qr: "显示二维码",
        btn_hide_qr: "隐藏二维码",
        form_name: "全名",
        form_company: "公司",
        form_message: "留言",
        form_email: "电子邮件",
        form_submit: "发送咨询",
        footer_tagline: "可再生原料领域的领导者。",
        nav_privacy: "隐私政策",
        nav_terms: "服务条款",
        scan_qr: "扫描二维码",
        form_success: "谢谢！您的咨询已发送。自动确认邮件已发送至您的电子邮箱。",
        form_error: "糟糕！提交表格时出现问题。请再试一次。",
        gallery_title: "运营图库",
        gallery_subtitle: "一瞥我们的日常收集和加工业务。",
        upload_title: "上传图库照片",
        upload_label: "点击添加照片（永久存储在您的浏览器中）",
        btn_upload: "上传照片",
        specs_title: "技术规格",
        specs_subtitle: "质量标准（根据最终买方的要求而异）。",
        spec_param: "参数",
        spec_value: "典型值（示例）",
        spec_viscosity: "粘度 @ 40°C",
        spec_buyer_req: "按买方要求",
        certs_title: "认证与文件",
        cert_safety_title: "质量与安全",
        cert_safety_desc: "符合 ISO 22000 / HACCP 标准，确保从源头到出口的完全可追溯性。",
        cert_sus_title: "可持续性",
        cert_sus_desc: "完全符合 ISCC、RSB 和 RED II 标准，确保合法和可追溯的采购。",
        cert_docs_title: "出口文件",
        nav_specs: "技术规格",
        reg_title: "出口与法规",
        reg_desc: "我们严格遵守印尼贸易法规，确保有效的许可证以实现不间断的全球配送。"
    },
    id: {
        nav_about: "Tentang Kami",
        nav_process: "Proses Kami",
        nav_impact: "Keberlanjutan",
        nav_contact: "Kontak",
        hero_title: "Memberdayakan Masa Depan dengan <span class='text-gradient'>Energi Terbarukan</span>",
        hero_subtitle: "Pemimpin global dalam pengumpulan dan ekspor Minyak Goreng Bekas (UCO) untuk produksi biodiesel.",
        btn_partner: "Bermitra Dengan Kami",
        btn_learn_more: "Pelajari Lebih Lanjut",
        cert_iscc: "Sertifikasi ISCC",
        cert_traceable: "100% Terlacak",
        cert_global: "Rantai Ekspor Global",
        news_title: "Zona EBT News",
        news_1: "Penjualan Listrik Indonesia menurut Jenis Konsumen: Rumah Tangga Dominan 2026.",
        news_2: "Toyota Motor Manufacturing Indonesia Gelar Pelatihan Pemeliharaan PLTS 2026.",
        news_3: "Produksi Listrik Indonesia menurut Jenis Pembangkit: Fosil Masih Dominan, EBT Mulai Tumbuh.",
        news_4: "Sertifikasi ISCC: Kunci Utama Bahan Baku Biofuel Berkelanjutan Global.",
        news_url_1: "https://zonaebt.com/",
        news_url_2: "https://zonaebt.com/",
        news_url_3: "https://zonaebt.com/",
        news_body_1: "Penjualan listrik di Indonesia terus didominasi oleh sektor rumah tangga, yang menyumbang lebih dari 45% dari total konsumsi.",
        news_body_2: "Toyota Motor Manufacturing Indonesia (TMMIN) telah meluncurkan program pelatihan komprehensif untuk pemeliharaan PLTS.",
        news_body_3: "Produksi energi Indonesia saat ini masih sangat bergantung pada bahan bakar fosil, namun sektor EBT menunjukkan pertumbuhan signifikan.",
        about_title: "Mengubah Limbah Menjadi Nilai",
        about_desc1: "Kami adalah eksportir utama Minyak Goreng Bekas (UCO), menjembatani bahan baku lokal dengan pasar energi terbarukan global.",
        about_desc2: "Dengan kepatuhan ketat pada standar ISCC, kami memastikan setiap tetes minyak berkontribusi pada planet yang lebih hijau.",
        quality_guaranteed: "Kualitas Premium <br> Terjamin",
        process_title: "Rantai Pasokan Kami",
        process_subtitle: "Integrasi mulus dari pengumpulan hingga ekspor akhir.",
        step1_title: "Pengumpulan",
        step1_desc: "Mendapatkan UCO terverifikasi dari restoran dan mitra industri.",
        step2_title: "Pemurnian",
        step2_desc: "Menyaring kotoran untuk memenuhi standar bahan bakar terbarukan.",
        step3_title: "Pengujian",
        step3_desc: "Pengujian laboratorium ketat untuk kadar asam lemak bebas (FFA) dan kadar air.",
        step4_title: "Ekspor Global",
        step4_desc: "Pengiriman melalui Flexibags ke kilang biodiesel di Eropa & Asia.",
        vision_title: "Mendorong Ekonomi Sirkular",
        vision_text: "Operasi kami mendukung pengurangan emisi gas rumah kaca dengan mengubah limbah menjadi bahan baku biodiesel bernilai tinggi.",
        contact_title: "Hubungi Kami",
        contact_desc: "Tertarik untuk membeli atau bermitra? Hubungi tim perdagangan global kami.",
        contact_hq: "Kantor Pusat",
        contact_email: "Email Kami",
        contact_whatsapp: "WhatsApp (24/7)",
        contact_wechat: "WeChat",
        btn_show_qr: "Tampilkan QR",
        btn_hide_qr: "Sembunyikan QR",
        form_name: "Nama Lengkap",
        form_company: "Perusahaan",
        form_message: "Pesan",
        form_email: "Alamat Email",
        form_submit: "Kirim Pertanyaan",
        footer_tagline: "Memimpin dalam bahan baku energi terbarukan.",
        nav_privacy: "Kebijakan Privasi",
        nav_terms: "Syarat & Ketentuan",
        scan_qr: "Scan Kode QR",
        form_success: "Terima kasih! Pertanyaan Anda telah dikirim. Konfirmasi otomatis telah dikirim ke email Anda.",
        form_error: "Ups! Terjadi masalah saat mengirim formulir Anda. Silakan coba lagi.",
        gallery_title: "Galeri Operasional",
        gallery_subtitle: "Sekilas tentang operasi pengumpulan dan pemrosesan harian kami.",
        upload_title: "Unggah Foto Galeri",
        upload_label: "Klik untuk tambah foto (Tersimpan di browser Anda)",
        btn_upload: "Unggah",
        specs_title: "Spesifikasi Teknis",
        specs_subtitle: "Standar kualitas (Berbeda menurut permintaan buyer akhir).",
        spec_param: "Parameter",
        spec_value: "Nilai Umum (Contoh)",
        spec_viscosity: "Viskositas @ 40°C",
        spec_buyer_req: "Spesifik Tergantung Buyer",
        certs_title: "Sertifikasi & Dokumentasi",
        cert_safety_title: "Mutu & Keamanan",
        cert_safety_desc: "Kepatuhan ISO 22000 / HACCP (Food Safety Handling) memastikan traceability sangat penting.",
        cert_sus_title: "Keberlanjutan",
        cert_sus_desc: "Kepatuhan ISCC, RSB, dan RED II untuk memastikan asal minyak legal dan terlacak.",
        cert_docs_title: "Dokumentasi Ekspor",
        nav_specs: "Spesifikasi",
        reg_title: "Ekspor & Regulasi",
        reg_desc: "Kami mematuhi regulasi perdagangan Indonesia, memastikan izin ekspor yang valid untuk distribusi global yang lancar."
    }
};

document.addEventListener('DOMContentLoaded', () => {
    // Preloader Logic
    const preloader = document.getElementById('preloader');
    if (preloader) {
        window.addEventListener('load', () => {
            setTimeout(() => {
                preloader.classList.add('fade-out');
            }, 500);
        });
    }

    // Navbar Scroll Logic
    const navbar = document.querySelector('.navbar');
    window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });

    // Admin Mode Logic
    const adminUploadPanel = document.getElementById('admin-upload-section');
    const adminGalleryTitle = document.querySelector('[data-i18n="gallery_title"]');
    const adminLoginLink = document.getElementById('admin-login-link');
    const ADMIN_PASS = 'IndoPalm2024';

    function refreshAdminView() {
        const isAdmin = localStorage.getItem('uco_admin_active') === 'true';
        if (isAdmin) {
            document.body.classList.add('admin-mode');
            if (adminUploadPanel) adminUploadPanel.style.display = 'block';
            if (adminLoginLink) adminLoginLink.textContent = 'Admin (Logout)';
        } else {
            document.body.classList.remove('admin-mode');
            if (adminUploadPanel) adminUploadPanel.style.display = 'none';
            if (adminLoginLink) adminLoginLink.textContent = 'Admin';
        }
    }
    refreshAdminView();

    function handleAdminToggle() {
        const isAdmin = localStorage.getItem('uco_admin_active') === 'true';
        if (isAdmin) {
            if (confirm('Logout from Admin Mode?')) {
                localStorage.removeItem('uco_admin_active');
                location.reload();
            }
        } else {
            const passInput = prompt('Enter Admin Password:');
            if (passInput === ADMIN_PASS) {
                localStorage.setItem('uco_admin_active', 'true');
                location.reload();
            }
        }
    }

    if (adminLoginLink) adminLoginLink.addEventListener('click', handleAdminToggle);

    // Language Switcher
    const langToggle = document.getElementById('lang-toggle');
    const currentLangSpan = document.getElementById('current-lang');
    let currentLang = 'en';

    langToggle.addEventListener('click', () => {
        if (currentLang === 'en') currentLang = 'zh';
        else if (currentLang === 'zh') currentLang = 'id';
        else currentLang = 'en';
        currentLangSpan.textContent = currentLang.toUpperCase();
        updateLanguage(currentLang);
    });

    function updateLanguage(lang) {
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            if (translations[lang][key]) {
                if (translations[lang][key].includes('<')) element.innerHTML = translations[lang][key];
                else element.textContent = translations[lang][key];
            }
        });
    }

    // Scroll Animations
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.classList.add('visible');
        });
    }, { threshold: 0.1 });
    document.querySelectorAll('.fade-in-section').forEach(section => observer.observe(section));

    // Mobile Menu
    const mobileToggle = document.querySelector('.mobile-toggle');
    const navLinks = document.querySelector('.nav-links');
    if (mobileToggle) {
        mobileToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            const icon = mobileToggle.querySelector('i');
            icon.className = navLinks.classList.contains('active') ? 'fa-solid fa-times' : 'fa-solid fa-bars';
        });
    }

    // WeChat QR Toggle
    const wechatBtn = document.getElementById('float-wechat-btn');
    const qrPopup = document.getElementById('float-qr-popup');
    if (wechatBtn && qrPopup) {
        wechatBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            qrPopup.classList.toggle('visible');
            qrPopup.classList.toggle('hidden');
        });
        document.addEventListener('click', () => {
            qrPopup.classList.remove('visible');
            qrPopup.classList.add('hidden');
        });
    }

    // Gallery Logic
    const galleryGrid = document.getElementById('gallery-grid');
    const photoUpload = document.getElementById('photo-upload');
    const GALLERY_STORAGE_KEY = 'uco_gallery_images';

    function createGalleryItem(src) {
        if (!galleryGrid) return;
        const div = document.createElement('div');
        div.className = 'gallery-item fade-in-section visible';
        div.innerHTML = `
            <img src="${src}" alt="Gallery" onerror="this.src='https://placehold.co/600x400?text=Photo+Missing'">
            <button class="delete-btn" onclick="deleteImage(this)"><i class="fa-solid fa-trash"></i></button>
        `;
        galleryGrid.appendChild(div);
    }

    window.deleteImage = function (btn) {
        if (confirm('Delete this photo?')) {
            const img = btn.parentElement.querySelector('img').src;
            let images = JSON.parse(localStorage.getItem(GALLERY_STORAGE_KEY)) || [];
            localStorage.setItem(GALLERY_STORAGE_KEY, JSON.stringify(images.filter(s => s !== img)));
            btn.parentElement.remove();
        }
    };

    if (galleryGrid) {
        const saved = JSON.parse(localStorage.getItem(GALLERY_STORAGE_KEY)) || [
            'uploaded_media_0_1769634290687.jpg',
            'uploaded_media_1_1769634290687.jpg',
            'uploaded_media_2_1769634290687.jpg',
            'uploaded_media_3_1769634290687.jpg'
        ];
        saved.forEach(createGalleryItem);
    }

    if (photoUpload) {
        photoUpload.addEventListener('change', (e) => {
            Array.from(e.target.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const images = JSON.parse(localStorage.getItem(GALLERY_STORAGE_KEY)) || [];
                    images.push(ev.target.result);
                    localStorage.setItem(GALLERY_STORAGE_KEY, JSON.stringify(images));
                    createGalleryItem(ev.target.result);
                };
                reader.readAsDataURL(file);
            });
        });
    }

    // Hero Slider
    const slides = document.querySelectorAll('.hero-slide');
    let slideIdx = 0;
    if (slides.length > 0) {
        setInterval(() => {
            slides[slideIdx].classList.remove('active');
            slideIdx = (slideIdx + 1) % slides.length;
            slides[slideIdx].classList.add('active');
        }, 7000);
    }

    // Form Logic
    const contactForm = document.getElementById('contact-form');
    if (contactForm) {
        contactForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('form-submit-btn');
            const status = document.getElementById('form-status');
            btn.classList.add('loading');
            try {
                const res = await fetch(contactForm.action, {
                    method: 'POST',
                    body: new FormData(contactForm),
                    headers: { 'Accept': 'application/json' }
                });
                if (res.ok) {
                    status.textContent = translations[currentLang].form_success;
                    status.className = 'form-status success';
                    contactForm.reset();
                } else {
                    status.textContent = translations[currentLang].form_error;
                    status.className = 'form-status error';
                }
            } catch (err) {
                status.className = 'form-status error';
            } finally {
                btn.classList.remove('loading');
            }
        });
    }

    // Lightbox
    const lb = document.getElementById('lightbox-modal');
    const lbImg = document.getElementById('lightbox-img');
    if (lb && galleryGrid) {
        galleryGrid.addEventListener('click', (e) => {
            if (e.target.tagName === 'IMG' && !e.target.closest('.delete-btn')) {
                lb.style.display = 'block';
                lbImg.src = e.target.src;
                document.body.style.overflow = 'hidden';
            }
        });
        lb.addEventListener('click', () => {
            lb.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
    }

    // --- AUTOMATIC LIVE NEWS UPDATE SCRIPT (PRESTIGE VERSION) ---
    const newsTrack = document.querySelector('.news-track');
    const newsModal = document.getElementById('news-modal');
    const newsModalImg = document.getElementById('news-modal-img');
    const newsModalTitle = document.getElementById('news-modal-title');
    const newsModalText = document.getElementById('news-modal-text');
    const modalMeta = document.getElementById('modal-meta');
    const closeModal = newsModal ? newsModal.querySelector('.close-modal') : null;
    const btnPrev = document.getElementById('news-prev');
    const btnNext = document.getElementById('news-next');

    async function fetchLatestEnergyNews() {
        if (!newsTrack) return;

        // Show placeholders initially
        newsTrack.innerHTML = Array(6).fill('<div class="skeleton-card skeleton"></div>').join('');

        try {
            const rssUrl = encodeURIComponent('https://zonaebt.com/feed/');
            const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${rssUrl}`);
            const data = await response.json();

            if (data.status === 'ok' && data.items.length > 0) {
                renderNewsCards(data.items);
            }
        } catch (error) {
            console.error('News auto-update failed:', error);
        }
    }

    function renderNewsCards(items) {
        newsTrack.innerHTML = '';
        const newsItems = items.slice(0, 10); // More items for manual surfing

        const createCard = (item) => {
            const card = document.createElement('div');
            card.className = 'news-card';

            const pubDate = new Date(item.pubDate);
            const isNew = (new Date() - pubDate) < (48 * 60 * 60 * 1000); // 48h
            const category = item.categories?.[0] || 'UCO Insight';
            const displayTitle = item.title.replace(/zonaebt|zona ebt/gi, '').trim();
            const dateStr = pubDate.toLocaleDateString(undefined, { day: 'numeric', month: 'short' });
            const words = (item.content || item.description || "").split(' ').length;
            const readTime = Math.ceil(words / 200) + " min read";

            card.innerHTML = `
                <div class="news-img-container">
                    <span class="news-badge ${isNew ? 'pulse-new' : ''}">${category}</span>
                    <img src="${item.thumbnail || 'https://images.unsplash.com/photo-1466611653911-95282fc3656b?q=80&w=800'}" alt="News">
                </div>
                <div class="news-card-body">
                    <div class="news-meta">
                        <span><i class="fa-regular fa-calendar"></i> ${dateStr}</span>
                        <span><i class="fa-regular fa-clock"></i> ${readTime}</span>
                    </div>
                    <p>${displayTitle}</p>
                    <span class="read-more">Learn More <i class="fa-solid fa-arrow-right"></i></span>
                </div>
            `;

            card.addEventListener('click', () => {
                if (newsModal) {
                    newsModalImg.src = item.thumbnail || 'https://images.unsplash.com/photo-1466611653911-95282fc3656b?q=80&w=800';
                    newsModalTitle.textContent = displayTitle;
                    if (modalMeta) {
                        modalMeta.innerHTML = `
                            <span><i class="fa-regular fa-calendar-check"></i> Published: ${pubDate.toLocaleDateString()}</span>
                            <span><i class="fa-regular fa-hourglass-half"></i> ${readTime}</span>
                        `;
                    }

                    let finalContent = "";
                    if (item.link.includes('potensi-using-cooking-oil') || item.title.toLowerCase().includes('potensi uco')) {
                        finalContent = "Indonesia is strategically positioned as a global hub for sustainable biofuel feedstock. With national cooking oil consumption at 16 million kiloliters, there is a collection potential of over 3 million kiloliters of high-quality UCO annually.\n\nAt UCO Bioenergy, we are optimizing this supply chain by implementing advanced collection mechanisms and rigorous ISCC purification standards. Our data indicates that Indonesian UCO is highly prioritized in global markets (especially the EU) due to its superior low-carbon intensity profile. By transforming this waste into a high-value energy asset, we protect local ecosystems while fueling the world's transition to carbon neutrality.";
                    } else {
                        let rawContent = item.content || item.description || "Detailed report under editorial review.";
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = rawContent;
                        let cleanText = (tempDiv.textContent || tempDiv.innerText || "").replace(/zonaebt|zona ebt|baca juga|baca selengkapnya/gi, '').trim();
                        finalContent = cleanText;
                    }
                    newsModalText.textContent = finalContent;
                    newsModal.style.display = 'block';
                    document.body.style.overflow = 'hidden';
                    newsModal.scrollTop = 0;
                }
            });
            return card;
        };
        newsItems.forEach(item => newsTrack.appendChild(createCard(item)));
        newsItems.forEach(item => newsTrack.appendChild(createCard(item)));
    }

    // Manual Slider Logic
    if (btnPrev && btnNext && newsTrack) {
        const scrollAmount = 350; // Approximated card width + gap

        btnNext.addEventListener('click', () => {
            newsTrack.style.animation = 'none'; // Pause marquee on manual interaction
            newsTrack.parentElement.scrollBy({ left: scrollAmount, behavior: 'smooth' });
        });

        btnPrev.addEventListener('click', () => {
            newsTrack.style.animation = 'none';
            newsTrack.parentElement.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
        });
    }

    // Modal Close Logic
    if (closeModal) {
        closeModal.addEventListener('click', () => {
            newsModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
    }

    if (newsModal) {
        window.addEventListener('click', (e) => {
            if (e.target === newsModal) {
                newsModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });
    }

    fetchLatestEnergyNews();
});
